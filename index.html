<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculator MVP Web App with Animated Background</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <style>
    /* Custom scrollbar for history */
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background-color: rgba(100, 116, 139, 0.5);
      border-radius: 3px;
    }

    /* Animated background container */
    #animated-bg {
      position: fixed;
      inset: 0;
      z-index: -1;
      overflow: hidden;
      background: linear-gradient(270deg, #4f46e5, #3b82f6, #06b6d4, #4f46e5);
      background-size: 800% 800%;
      animation: gradientShift 30s ease infinite;
    }

    @keyframes gradientShift {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    /* Floating circles animation */
    .floating-circle {
      position: absolute;
      border-radius: 50%;
      opacity: 0.15;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
      animation-direction: alternate;
      filter: drop-shadow(0 0 6px rgba(255 255 255 / 0.3));
    }

    .circle1 {
      width: 120px;
      height: 120px;
      background: #3b82f6;
      top: 10%;
      left: 15%;
      animation-name: floatUpDown1;
      animation-duration: 8s;
    }

    .circle2 {
      width: 80px;
      height: 80px;
      background: #06b6d4;
      top: 70%;
      left: 75%;
      animation-name: floatUpDown2;
      animation-duration: 12s;
    }

    .circle3 {
      width: 150px;
      height: 150px;
      background: #4f46e5;
      top: 40%;
      left: 50%;
      animation-name: floatUpDown3;
      animation-duration: 10s;
    }

    @keyframes floatUpDown1 {
      0% {
        transform: translateY(0) translateX(0);
        opacity: 0.15;
      }
      100% {
        transform: translateY(-30px) translateX(10px);
        opacity: 0.25;
      }
    }

    @keyframes floatUpDown2 {
      0% {
        transform: translateY(0) translateX(0);
        opacity: 0.15;
      }
      100% {
        transform: translateY(25px) translateX(-15px);
        opacity: 0.3;
      }
    }

    @keyframes floatUpDown3 {
      0% {
        transform: translateY(0) translateX(0);
        opacity: 0.15;
      }
      100% {
        transform: translateY(-20px) translateX(-20px);
        opacity: 0.2;
      }
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4 relative overflow-hidden">
  <div id="animated-bg" aria-hidden="true">
    <div class="floating-circle circle1"></div>
    <div class="floating-circle circle2"></div>
    <div class="floating-circle circle3"></div>
  </div>

  <div
    id="app"
    class="bg-white rounded-xl shadow-lg w-full max-w-md flex flex-col relative z-10"
    role="main"
    aria-label="Calculator application"
  >
    <!-- View -->
    <div class="flex flex-col p-4 space-y-4">
      <div
        id="display"
        class="bg-gray-900 text-white text-right text-4xl font-mono rounded-lg p-4 min-h-[3.5rem] break-words select-text"
        aria-live="polite"
        aria-atomic="true"
        tabindex="0"
      >
        0
      </div>
      <div
        id="result"
        class="text-right text-green-600 font-semibold text-xl min-h-[1.5rem] select-text"
        aria-live="polite"
        aria-atomic="true"
        tabindex="0"
      ></div>
    </div>

    <div
      id="buttons"
      class="grid grid-cols-4 gap-2 p-4 border-t border-gray-300"
      role="group"
      aria-label="Calculator buttons"
    >
      <button
        type="button"
        class="btn-clear text-red-600 font-bold text-lg bg-gray-200 rounded-lg hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-red-400"
        aria-label="Clear all"
      >
        C
      </button>
      <button
        type="button"
        class="btn-memory-clear text-gray-600 font-bold text-lg bg-gray-200 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400"
        aria-label="Memory clear"
      >
        MC
      </button>
      <button
        type="button"
        class="btn-memory-recall text-gray-600 font-bold text-lg bg-gray-200 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400"
        aria-label="Memory recall"
      >
        MR
      </button>
      <button
        type="button"
        class="btn-operator text-blue-600 font-bold text-lg bg-gray-200 rounded-lg hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-400"
        aria-label="Divide"
        data-value="/"
      >
        &divide;
      </button>

      <button
        type="button"
        class="btn-digit text-gray-800 font-semibold text-lg bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400"
        data-value="7"
        aria-label="Digit 7"
      >
        7
      </button>
      <button
        type="button"
        class="btn-digit text-gray-800 font-semibold text-lg bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400"
        data-value="8"
        aria-label="Digit 8"
      >
        8
      </button>
      <button
        type="button"
        class="btn-digit text-gray-800 font-semibold text-lg bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400"
        data-value="9"
        aria-label="Digit 9"
      >
        9
      </button>
      <button
        type="button"
        class="btn-operator text-blue-600 font-bold text-lg bg-gray-200 rounded-lg hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-400"
        aria-label="Multiply"
        data-value="*"
      >
        &times;
      </button>

      <button
        type="button"
        class="btn-digit text-gray-800 font-semibold text-lg bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400"
        data-value="4"
        aria-label="Digit 4"
      >
        4
      </button>
      <button
        type="button"
        class="btn-digit text-gray-800 font-semibold text-lg bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400"
        data-value="5"
        aria-label="Digit 5"
      >
        5
      </button>
      <button
        type="button"
        class="btn-digit text-gray-800 font-semibold text-lg bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400"
        data-value="6"
        aria-label="Digit 6"
      >
        6
      </button>
      <button
        type="button"
        class="btn-operator text-blue-600 font-bold text-lg bg-gray-200 rounded-lg hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-400"
        aria-label="Subtract"
        data-value="-"
      >
        &minus;
      </button>

      <button
        type="button"
        class="btn-digit text-gray-800 font-semibold text-lg bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400"
        data-value="1"
        aria-label="Digit 1"
      >
        1
      </button>
      <button
        type="button"
        class="btn-digit text-gray-800 font-semibold text-lg bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400"
        data-value="2"
        aria-label="Digit 2"
      >
        2
      </button>
      <button
        type="button"
        class="btn-digit text-gray-800 font-semibold text-lg bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400"
        data-value="3"
        aria-label="Digit 3"
      >
        3
      </button>
      <button
        type="button"
        class="btn-operator text-blue-600 font-bold text-lg bg-gray-200 rounded-lg hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-400"
        aria-label="Add"
        data-value="+"
      >
        +
      </button>

      <button
        type="button"
        class="btn-digit text-gray-800 font-semibold text-lg bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400 col-span-2"
        data-value="0"
        aria-label="Digit 0"
      >
        0
      </button>
      <button
        type="button"
        class="btn-decimal text-gray-800 font-semibold text-lg bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400"
        data-value="."
        aria-label="Decimal point"
      >
        .
      </button>
      <button
        type="button"
        class="btn-equals text-white font-bold text-lg bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
        aria-label="Equals"
      >
        =
      </button>
    </div>
  </div>

  <script>
    // Model: Handles calculation logic and memory
    class CalculatorModel {
      constructor() {
        this.memory = 0;
      }

      calculate(expression) {
        try {
          // Sanitize expression: allow only digits, operators, decimal, parentheses, spaces
          if (!/^[0-9+\-*/().\s]+$/.test(expression)) {
            throw new Error("Invalid characters in expression");
          }
          // Evaluate expression safely using Function constructor
          // eslint-disable-next-line no-new-func
          const func = new Function("return " + expression);
          const result = func();

          if (typeof result !== "number" || !isFinite(result)) {
            throw new Error("Invalid calculation");
          }
          return result;
        } catch (e) {
          throw new Error("Error in calculation");
        }
      }

      memoryClear() {
        this.memory = 0;
      }

      memoryRecall() {
        return this.memory;
      }

      memoryAdd(value) {
        if (typeof value === "number" && isFinite(value)) {
          this.memory += value;
        }
      }

      memorySubtract(value) {
        if (typeof value === "number" && isFinite(value)) {
          this.memory -= value;
        }
      }
    }

    // View: Handles UI and user input
    class CalculatorView {
      constructor() {
        this.displayEl = document.getElementById("display");
        this.resultEl = document.getElementById("result");
        this.buttonsEl = document.getElementById("buttons");

        this.onDigitPressed = null;
        this.onOperatorPressed = null;
        this.onClearPressed = null;
        this.onEqualsPressed = null;
        this.onDecimalPressed = null;
        this.onMemoryClearPressed = null;
        this.onMemoryRecallPressed = null;
      }

      init() {
        this.buttonsEl.addEventListener("click", (e) => {
          const target = e.target;
          if (target.tagName !== "BUTTON") return;

          if (target.classList.contains("btn-digit")) {
            this.onDigitPressed && this.onDigitPressed(target.dataset.value);
          } else if (target.classList.contains("btn-operator")) {
            this.onOperatorPressed && this.onOperatorPressed(target.dataset.value);
          } else if (target.classList.contains("btn-clear")) {
            this.onClearPressed && this.onClearPressed();
          } else if (target.classList.contains("btn-equals")) {
            this.onEqualsPressed && this.onEqualsPressed();
          } else if (target.classList.contains("btn-decimal")) {
            this.onDecimalPressed && this.onDecimalPressed(target.dataset.value);
          } else if (target.classList.contains("btn-memory-clear")) {
            this.onMemoryClearPressed && this.onMemoryClearPressed();
          } else if (target.classList.contains("btn-memory-recall")) {
            this.onMemoryRecallPressed && this.onMemoryRecallPressed();
          }
        });
      }

      updateDisplay(value) {
        this.displayEl.textContent = value;
      }

      updateResult(value) {
        this.resultEl.textContent = value;
      }
    }

    // Presenter: Connects View and Model
    class CalculatorPresenter {
      constructor(view, model) {
        this.view = view;
        this.model = model;
        this.expression = "";
        this.lastInputType = null; // "digit", "operator", "decimal"
        this.hasDecimal = false;

        this.view.onDigitPressed = this.handleDigit.bind(this);
        this.view.onOperatorPressed = this.handleOperator.bind(this);
        this.view.onClearPressed = this.handleClear.bind(this);
        this.view.onEqualsPressed = this.handleEquals.bind(this);
        this.view.onDecimalPressed = this.handleDecimal.bind(this);
        this.view.onMemoryClearPressed = this.handleMemoryClear.bind(this);
        this.view.onMemoryRecallPressed = this.handleMemoryRecall.bind(this);

        this.view.init();
        this.view.updateDisplay("0");
        this.view.updateResult("");
      }

      handleDigit(digit) {
        if (this.expression === "0" && digit === "0") {
          // Prevent multiple leading zeros
          return;
        }
        if (
          this.expression === "0" &&
          digit !== "0" &&
          this.lastInputType !== "decimal"
        ) {
          this.expression = digit;
        } else {
          this.expression += digit;
        }
        this.lastInputType = "digit";
        this.view.updateDisplay(this.expression);
      }

      handleOperator(operator) {
        if (this.expression === "") {
          // Prevent operator as first input except minus for negative number
          if (operator === "-") {
            this.expression = operator;
            this.lastInputType = "operator";
            this.view.updateDisplay(this.expression);
          }
          return;
        }
        // Prevent two operators in a row
        if (this.lastInputType === "operator") {
          // Replace last operator with new one
          this.expression = this.expression.slice(0, -1) + operator;
        } else {
          this.expression += operator;
        }
        this.lastInputType = "operator";
        this.hasDecimal = false;
        this.view.updateDisplay(this.expression);
      }

      handleDecimal(dot) {
        if (this.lastInputType === "operator" || this.expression === "") {
          // Start new number with "0."
          this.expression += "0.";
          this.hasDecimal = true;
          this.lastInputType = "decimal";
          this.view.updateDisplay(this.expression);
          return;
        }
        if (!this.hasDecimal) {
          this.expression += dot;
          this.hasDecimal = true;
          this.lastInputType = "decimal";
          this.view.updateDisplay(this.expression);
        }
      }

      handleClear() {
        this.expression = "";
        this.lastInputType = null;
        this.hasDecimal = false;
        this.view.updateDisplay("0");
        this.view.updateResult("");
      }

      handleEquals() {
        if (this.expression === "") return;
        // Remove trailing operators
        while (
          this.expression.length > 0 &&
          /[+\-*/.]$/.test(this.expression)
        ) {
          this.expression = this.expression.slice(0, -1);
        }
        try {
          const result = this.model.calculate(this.expression);
          this.view.updateResult("= " + result);
          this.expression = result.toString();
          this.view.updateDisplay(this.expression);
          this.lastInputType = "digit";
          this.hasDecimal = this.expression.includes(".");
        } catch (e) {
          this.view.updateResult("Error");
        }
      }

      handleMemoryClear() {
        this.model.memoryClear();
      }

      handleMemoryRecall() {
        const mem = this.model.memoryRecall();
        if (this.lastInputType === "digit" || this.lastInputType === "decimal") {
          this.expression += mem.toString();
        } else {
          this.expression = mem.toString();
        }
        this.view.updateDisplay(this.expression);
        this.lastInputType = "digit";
        this.hasDecimal = this.expression.includes(".");
      }
    }

    // Initialize app
    const model = new CalculatorModel();
    const view = new CalculatorView();
    const presenter = new CalculatorPresenter(view, model);
  </script>
</body>
                                           </html>
